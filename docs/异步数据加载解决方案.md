# 异步数据加载时序问题解决方案

## 🔍 问题分析

**时序冲突**：
1. `app.onLaunch()` → 调用 `silentLogin()` (异步网络请求)
2. `index.onLoad()` → 调用 `app.getAppConfig()` (此时配置可能还未加载完成)
3. 结果：`getAppConfig()` 返回 `null`

## 💡 解决方案对比

### 方案1：Promise 等待模式 ⭐⭐⭐⭐⭐
**优势**：简洁、可靠、易维护
**实现**：页面等待 app 登录完成后再继续

### 方案2：监听器回调模式 ⭐⭐⭐⭐
**优势**：实时响应、解耦
**实现**：配置加载完成时通知所有页面

### 方案3：页面重试机制 ⭐⭐⭐
**优势**：简单实现
**实现**：页面定时检查配置是否可用

### 方案4：本地缓存优先 ⭐⭐⭐⭐
**优势**：用户体验好、减少等待
**实现**：使用缓存配置，后台更新

### 方案5：页面生命周期调整 ⭐⭐
**优势**：简单
**实现**：改用 onShow 而不是 onLoad

## 🎯 推荐方案详解

### 方案1：Promise 等待模式（推荐）

**核心思路**：在 app.ts 中暴露一个 Promise，页面等待这个 Promise 完成

**优势**：
- ✅ 100% 可靠，不会有时序问题
- ✅ 代码清晰，易于理解
- ✅ 一次设置，全局生效

### 方案2：监听器回调模式

**核心思路**：使用事件系统，配置加载完成时广播通知

**优势**：
- ✅ 实时响应，无需等待
- ✅ 多页面可同时监听
- ✅ 解耦设计

### 方案4：本地缓存优先（用户体验最佳）

**核心思路**：先用缓存配置立即渲染，后台更新后再刷新

**优势**：
- ✅ 用户体验极佳，无等待感
- ✅ 离线可用
- ✅ 网络异常时有备用方案
