# 方案2：监听器回调模式

## 🎯 核心思路
使用事件监听机制，当配置加载完成时通知所有关注的页面。

## 📝 代码实现

### 1. 在 app.ts 中添加监听器管理

```typescript
// app.ts 新增属性
_configCallbacks: Array<(config: AppConfig) => void>

// 在 onLaunch 中初始化
onLaunch() {
  this._configCallbacks = [];
  // ... 其他初始化代码
}

// 注册配置加载完成回调
onConfigReady(callback: (config: AppConfig) => void) {
  if (this._isReady && this.globalData.appConfig) {
    // 如果配置已加载，立即执行回调
    callback(this.globalData.appConfig);
  } else {
    // 否则添加到等待队列
    this._configCallbacks.push(callback);
  }
}

// 通知所有监听器
_notifyConfigReady(config: AppConfig) {
  this._isReady = true;
  this._configCallbacks.forEach(callback => {
    try {
      callback(config);
    } catch (error) {
      console.error('配置回调执行失败:', error);
    }
  });
  this._configCallbacks = []; // 清空回调队列
}
```

### 2. 在页面中使用监听器

```typescript
// index.ts
loadConfigSettings() {
  const app = getApp();
  
  console.log('注册配置监听器...');
  app.onConfigReady((config) => {
    console.log('收到配置加载完成通知:', config);
    this.setData({
      homeFooterInfo1: config.homeFooterInfo1,
      homeFooterInfo2: config.homeFooterInfo2
    });
  });
}
```

## ✅ 优势
- 🎯 实时响应，配置一加载完成就立即更新
- 🔄 多页面可同时监听，解耦设计
- 📱 适合复杂应用，多个页面需要配置的场景

## ❌ 劣势
- 🔧 代码稍微复杂一些
- 💾 需要管理回调队列
