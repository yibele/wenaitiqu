# 📱 小程序云端配置系统使用说明

## 🎯 快速开始

### 1. 初始化配置数据

在微信开发者工具的**云数据库控制台**中：

1. 创建集合 `app_config`
2. 在集合中添加文档，文档 ID 设为 `global`
3. 将以下 JSON 内容复制粘贴到文档中：

```json
{
  "_id": "global",
  "rewardedVideoAdId": "adunit-xxx",
  "nativeTemplateAdId": "adunit-yyy", 
  "interstitialAdId": "adunit-zzz",
  "shareTitle": "提取文案 - 一键获取视频文案",
  "shareCover": "/static/imgs/index_icon.png",
  "homeNotice": "有问题请联系作者",
  "initialPoints": 100,
  "inviteRewardPoints": 50,
  "checkinPoints": 10,
  "adWatchInterval": 300,
  "homeFooterInfo1": "支持平台：抖音 小红书 B站 快手",
  "homeFooterInfo2": "复制文案和下载视频需要观看激励视频广告",
  "profileFooterInfo": "感谢您使用文案提取助手",
  "version": "1.0.0",
  "updateTime": "2024-01-20T00:00:00.000Z"
}
```

### 2. 部署云函数

确保 `login` 云函数已部署到云端（右键选择"上传并部署"）

### 3. 运行小程序

启动小程序，系统会自动在登录时获取配置信息

## 📋 配置项说明

| 配置项 | 字段名 | 类型 | 说明 |
|--------|--------|------|------|
| 🎬 激励广告ID | `rewardedVideoAdId` | string | 观看视频解锁内容的广告位ID |
| 📱 原生模板广告ID | `nativeTemplateAdId` | string | 页面内嵌广告位ID |
| 🖼️ 插屏广告ID | `interstitialAdId` | string | 全屏广告位ID |
| 📢 分享标题 | `shareTitle` | string | 微信分享时的标题 |
| 🖼️ 分享封面 | `shareCover` | string | 微信分享时的封面图片 |
| 📢 首页公告 | `homeNotice` | string | 首页显示的公告信息 |
| 💰 初始积分 | `initialPoints` | number | 新用户注册时获得的积分 |
| 🎁 邀请奖励 | `inviteRewardPoints` | number | 邀请新用户获得的积分 |
| ✅ 签到积分 | `checkinPoints` | number | 每日签到获得的积分 |
| ⏰ 广告间隔 | `adWatchInterval` | number | 用户观看广告的时间间隔（秒） |
| 📝 首页底部信息1 | `homeFooterInfo1` | string | 首页底部第一行显示文字 |
| 📝 首页底部信息2 | `homeFooterInfo2` | string | 首页底部第二行显示文字 |
| 📝 个人页面底部信息 | `profileFooterInfo` | string | 个人页面底部显示文字 |

## 🔧 如何修改配置

### 方法1：云数据库控制台（推荐）

1. 打开微信开发者工具
2. 进入云数据库控制台
3. 找到 `app_config` 集合
4. 点击 `global` 文档
5. 直接编辑需要修改的字段值
6. 保存修改

### 方法2：代码中的默认配置

如果需要修改默认配置（当数据库获取失败时使用），在以下文件中修改：
- `cloudfunctions/login/index.js` 第 24-40 行
- `miniprogram/app.ts` 第 178-194 行

## 🚀 配置生效机制

1. **用户登录时自动获取**：每次用户打开小程序，login 云函数会自动返回最新配置
2. **实时生效**：用户下次启动小程序时新配置就会生效
3. **容错机制**：如果获取配置失败，会自动使用内置的默认配置

## 📱 页面配置应用

### 首页 (index)
- ✅ 底部信息自动更新
- ✅ 分享标题和封面使用配置
- ✅ 激励广告ID使用配置

### 个人页面 (profile)  
- ✅ 底部信息自动更新
- ✅ 分享标题和封面使用配置

## ⚠️ 注意事项

1. **广告位ID**：需要在微信公众平台申请后替换 `adunit-xxx` 等占位符
2. **图片路径**：分享封面需要使用有效的图片链接
3. **数据格式**：确保数字类型的配置项使用数字而不是字符串
4. **配置更新**：修改配置后用户需要重启小程序才能看到更新

## 🔍 故障排查

### 配置获取失败
- 检查云数据库中是否存在 `app_config` 集合
- 检查文档ID是否为 `global`
- 检查 login 云函数是否正确部署

### 配置不生效
- 完全关闭小程序后重新打开
- 检查控制台是否有错误日志
- 确认数据库中的配置格式正确

## 📞 技术支持

如果在使用过程中遇到问题，请检查：
1. 云函数是否正确部署
2. 云数据库权限设置是否正确
3. 配置项的数据类型是否匹配
